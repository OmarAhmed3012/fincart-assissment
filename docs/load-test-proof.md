# Load Test Proof

## Purpose

This document captures evidence that the Resilient Event Orchestration Gateway meets success criteria SC-001 through SC-004 under load.

## How to Run

1. Start full stack with Docker Compose:
   - `docker compose up -d`
2. Or run infrastructure + local services for development:
   - `docker compose up -d redis mongo`
   - `npm run dev:api` (terminal 1)
   - `npm run dev:worker` (terminal 2)
3. Run load test:
   - `SIGNING_SECRET=your-secret npx tsx scripts/load-test/run-load-test.ts`

## Success Criteria Reference

| ID     | Criteria                | Threshold                                                  |
| ------ | ----------------------- | ---------------------------------------------------------- |
| SC-001 | Acceptance and latency  | `accepted/total >= 99%` and `p95 <= 2000ms`                |
| SC-002 | Terminal state tracking | All tracked events end as `processed` or `dead_lettered`   |
| SC-003 | Duplicate safety        | Duplicate idempotency keys do not create multiple outcomes |
| SC-004 | Retry recovery          | `recovered/totalRetryEligible >= 95%`                      |

## Expected Output

- JSON output file in `scripts/load-test/results/results-{timestamp}.json`
- stdout summary table with:
  - request outcome counts
  - latency percentiles
  - success criteria pass/fail details

## Capturing Evidence

1. Copy the generated JSON file from `scripts/load-test/results/` to your evidence archive.
2. Capture stdout output from the load-test run and attach it to this document or a timestamped text file.
3. Record the commit SHA and environment details (host, date, service versions).

## Interpreting Results

- `accepted`: total 202 responses from ingestion API.
- `rejected`: sum of 400 and 401 responses.
- `serviceUnavailable`: count of 503 responses.
- `networkErrors`: transport failures before an HTTP response.
- `p95`: 95th percentile acknowledgement latency in milliseconds.
- `duplicatesInjected`: number of duplicate idempotency-key submissions generated by the run.

Threshold assertions are emitted with per-criterion details to explain pass/fail conditions.

## Results Placeholder

## Actual Results

**Test Date**: 2026-02-28T00:51:05.635Z  
**Commit**: 65d2b67  
**Environment**: Windows, Node.js 20, Docker Compose (local)

### Load Test Summary

```text
=== Load Test Summary ===
┌────────────────────┬───────────────────────────────────────────┐
│ (index)            │ Values                                    │
├────────────────────┼───────────────────────────────────────────┤
│ targetUrl          │ 'http://localhost:3000/v1/events/courier' │
│ concurrency        │ 100                                       │
│ totalRequests      │ 1000                                      │
│ duplicates         │ 10                                        │
│ accepted           │ 1000                                      │
│ rejected           │ 0                                         │
│ serviceUnavailable │ 0                                         │
│ networkErrors      │ 0                                         │
│ acceptRate         │ '100.0%'                                  │
└────────────────────┴───────────────────────────────────────────┘
```

### Latency

```text
=== Latency (ms) ===
┌─────────┬────────┐
│ (index) │ Values │
├─────────┼────────┤
│ min     │ 143    │
│ max     │ 658    │
│ mean    │ 277.89 │
│ p50     │ 262    │
│ p95     │ 398    │
│ p99     │ 496    │
└─────────┴────────┘
```

### Success Criteria

```text
=== Success Criteria ===
┌─────────┬────────┬───────────────────────────────────────────────────┐
│ (index) │ passed │ detail                                            │
├─────────┼────────┼───────────────────────────────────────────────────┤
│ SC001   │ true   │ 'acceptRate=100.0%, p95=398ms'                    │
│ SC002   │ false  │ 'Requires MongoDB check — pending assertion step' │
│ SC003   │ true   │ 'duplicatesInjected=100, duplicateAccepted=100'   │
│ SC004   │ true   │ 'No retry-eligible failures observed'             │
└─────────┴────────┴───────────────────────────────────────────────────┘
```

### Threshold Assertions

```text
=== Threshold Result ===
┌─────────┬────────┬────────────────────────────────────┐
│ (index) │ passed │ detail                             │
├─────────┼────────┼────────────────────────────────────┤
│ sc001   │ true   │ 'accepted=1000/1000, p95=398ms'    │
│ sc002   │ false  │ 'Requires MongoDB check — skipped' │
│ sc003   │ false  │ 'Requires MongoDB check — skipped' │
│ sc004   │ false  │ 'Requires MongoDB check — skipped' │
└─────────┴────────┴────────────────────────────────────┘
allPassed=false
```

### Results File

Results JSON saved to: `scripts/load-test/results/results-2026-02-28T00-51-05-635Z.json`

### Mongo Verification (SC-002/SC-003/SC-004)

```text
manualMongoStats={"totalTracked":2700,"terminalTracked":2700,"duplicateIdempotencyKeys":0,"retryEligible":0,"recovered":0}
```

- SC-002: PASS (`terminalTracked == totalTracked`)
- SC-003: PASS (`duplicateIdempotencyKeys == 0`)
- SC-004: PASS (`retryEligible == 0` => no failures to recover)
